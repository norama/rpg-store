---
import themeHolder from 'styles/theme'

import { select } from 'projects/rpg/api/proxy'
import { T } from 'pubsub/messages'
import './InfoTable.css'

type IColumnDescriptor = { key: string; label: string }

interface Props {
  block: string
  width: string
  descriptor: IColumnDescriptor[]
}

const { block, width = '100%', descriptor } = Astro.props

const rpgInfo =
  block !== 'properties'
    ? await select<IInfoRaces | IInfoAdvantages | IInfoEquipments>(T.rpgInfo, block)
    : undefined

const ids = Object.keys(rpgInfo).sort()
console.log('rpgInfo', rpgInfo)

const theme = themeHolder.atom.get()
---

<div>
  <table class={theme} style={{ width }}>
    <thead>
      <tr>
        {descriptor.map((col) => <th>{col.label}</th>)}
      </tr>
    </thead>
    <tbody>
      {
        ids.map((id) => (
          <tr>
            {descriptor.map((col) => (
              <td>{rpgInfo[id][col.key]}</td>
            ))}
          </tr>
        ))
      }
    </tbody>
  </table>
</div>
